<html>
	<head>
		<meta charset="UTF-8"></meta>
		<title>a map</title>
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""></link>
		<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
		<script src="https://unpkg.com/leaflet-simplestyle"></script>
		<style>
			::-webkit-scrollbar {display: none;}
			.content {white-space: nowrap;overflow: hidden;}
			.map {position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; cursor: crosshair;}
			.leaflet-popup {
				width: 300px;
				white-space: normal;
			}
		</style>
	</head>
	<body>
		<div id="content" class="content">
			<map id="map" class="map"></map>
		</div>
		<script type="text/javascript">
			// utils
			var projectX = function(longitude) {
				return Math.floor((longitude / 360 + 0.5) * Math.pow(2, 24))
			}
			var projectY = function(latitude) {
				const sin = Math.sin(latitude * Math.PI / 180);
				const y2 = 0.5 - 0.25 * Math.log((1 + sin) / (1 - sin)) / Math.PI;
				const y3 = y2 < 0 ? 0 : y2 > 1 ? 1 : y2;
				return Math.floor(y3 * Math.pow(2, 24))
			}

			var projectedLocationToWord = function(x, y) {
				var key =''
				for (var i = 24; i >= 2; i -= 2) {
					var xUpper = (x & (1 << (i - 1))) != 0 ? 2 : 0
					var xLower = (x & (1 << (i - 2))) != 0 ? 1 : 0
					var yUpper = (y & (1 << (i - 1))) != 0 ? 2 : 0
					var yLower = (y & (1 << (i - 2))) != 0 ? 1 : 0
					var index = xUpper + xLower + (yUpper  + yLower) * 4
					key = key + String.fromCharCode(97 + index).toUpperCase()
				}
				return key
			}

			var BingLayer = L.TileLayer.extend({
				getTileUrl: function (tilePoint) {
					return L.Util.template(
						this._url,
						{q: this._quadKey(tilePoint.x, tilePoint.y, this._getZoomForUrl())});
					},
					_quadKey: function (x, y, z) {
						var quadKey = []
						for (var i = z; i > 0; i--) {
							var digit = '0'
							var mask = 1 << (i - 1)
							if ((x & mask) != 0) {
								digit++
							}
							if ((y & mask) != 0) {
								digit++
								digit++
							}
							quadKey.push(digit)
						}
						return quadKey.join('')
					}
			})

			var map = L.map('map', {maxBoundsViscosity: 1.0})
			map.setMaxBounds ([[-90,-180],[90,180]])
			L.control.scale({imperial: false}).addTo(map)
			var layers = L.control.layers()
			layers.addTo(map)

			var defaultBounds = null

			var mousedownInterval;
			map.on(
				'mousedown',
				function (e) {
					mousedownInterval = setInterval(
						function() {
							let longitude = Number (e.latlng.lng).toFixed (5)
							let latitude = Number (e.latlng.lat).toFixed (5)
							let zoom = map.getZoom()
							L
								.popup({closeOnClick: false})
								.setLatLng(e.latlng)
								.setContent(
									longitude + ', ' + latitude + '<br/>' + 
									projectedLocationToWord(projectX(longitude), projectY(latitude)) + '<br/>' + 
									'<a href="http://openstreetmap.org/#map=16/' + e.latlng.lat + '/' + e.latlng.lng + '" target="_blank">osm</a></br>' + 
									'<a href="https://preview.ideditor.com/release/#map=16/' + e.latlng.lat + '/' + e.latlng.lng + '" target="_blank">iD</a></br>' + 
									'<a href="http://localhost:8080/#map=16/' + e.latlng.lat + '/' + e.latlng.lng + '" target="_blank">iD (localhost)</a></br>' + 
									'<a href="https://www.mapillary.com/app/?focus=map&z=16&lat=' + e.latlng.lat + '&lng=' + e.latlng.lng + '" target="_blank">mapillary</a></br>'
									)
								.openOn(map)},
						500)})
			map.on(
				'mousemove',
				function(e) { clearInterval(mousedownInterval) })
			map.on(
				'mouseup',
				function(e) { clearInterval(mousedownInterval) })

			var layer24 = L.tileLayer(
				'https://tile.openstreetmap.org/{z}/{x}/{y}.png',
				{
					attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
					maxZoom: 21,
					bounds: [[-90,-180],[90,180]],
					noWrap: true
				})
			layer24.addTo(map)
			layers.addBaseLayer(layer24, 'osm tile')

			var layer25 = new BingLayer(
				'http://ecn.t3.tiles.virtualearth.net/tiles/a{q}.jpeg?g=1',
				{
					attribution: '&copy; Bing Maps',
					maxZoom: 21,
					bounds: [[-90,-180],[90,180]],
					noWrap: true
				})
			layers.addBaseLayer(layer25, 'bing satellite')

			var layer26 = L.geoJSON(
				{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"stroke":"#0000FF"},"geometry":{"type":"LineString","coordinates":[[20.002195,44.10892],[20.002195,44.108919],[20.002178,44.10888],[20.002143,44.108799],[20.0021,44.108708],[20.002041,44.108592],[20.001942,44.108377],[20.001853,44.108041],[20.00178,44.107854],[20.001808,44.107822],[20.002085,44.107767],[20.002468,44.107705],[20.002451,44.107681],[20.001956,44.106989],[20.000938,44.105409],[20.000819,44.105259],[20.000734,44.105152],[20.000522,44.104919],[20.000243,44.104646],[20.000222,44.104625],[20.000104,44.104652],[19.999878,44.104707],[19.999673,44.104722],[19.999478,44.104795],[19.999392,44.104851],[19.999342,44.104893],[19.99905,44.10502],[19.998588,44.105346],[19.998152,44.105555],[19.998015,44.105659],[19.99795,44.105777],[19.99795,44.105777],[19.997684,44.105901],[19.997143,44.106426],[19.996807,44.106439],[19.996614,44.106382],[19.995718,44.106489],[19.995498,44.106586],[19.995382,44.106588],[19.995269,44.106591],[19.995246,44.106591],[19.994484,44.106543],[19.994365,44.106495],[19.994356,44.106491],[19.994232,44.106439],[19.993604,44.105969],[19.993329,44.105862],[19.993229,44.105823],[19.992988,44.105811],[19.992972,44.105781],[19.9928,44.105447],[19.992649,44.105293],[19.991675,44.104755],[19.991528,44.104643],[19.991455,44.104599],[19.991306,44.104517],[19.991004,44.104299],[19.990392,44.103852],[19.990007,44.103643],[19.989992,44.103641],[19.990007,44.103643],[19.989938,44.103443],[19.989884,44.103288],[19.989831,44.103002],[19.989815,44.102784],[19.989787,44.102775],[19.989815,44.102784],[19.98992,44.102683],[19.990074,44.102653],[19.990431,44.102622],[19.990483,44.102603],[19.990523,44.102565],[19.990571,44.102569],[19.990647,44.10255],[19.990665,44.102531],[19.990691,44.102505],[19.990762,44.102496],[19.990858,44.102511],[19.990973,44.102502],[19.991065,44.102449],[19.991093,44.102369],[19.991126,44.102224],[19.991237,44.102097],[19.991267,44.102123],[19.9916,44.102421],[19.991643,44.102466],[19.991671,44.102515],[19.99169,44.102616],[19.991691,44.102668],[19.991755,44.102688],[19.991797,44.102965],[19.991866,44.103023],[19.991995,44.103023],[19.992167,44.102938],[19.992341,44.102736],[19.992483,44.102572],[19.99288,44.102291],[19.992951,44.102265],[19.99303,44.10226],[19.993135,44.102267],[19.993234,44.102291],[19.993406,44.102356],[19.993916,44.102732],[19.994175,44.102923],[19.994292,44.102987],[19.994333,44.10298],[19.994377,44.102973],[19.994457,44.102865],[19.994487,44.102665],[19.994554,44.10221],[19.995031,44.1012],[19.995058,44.100938],[19.995439,44.100495],[19.995479,44.100387],[19.995536,44.100237],[19.996158,44.099914],[19.996367,44.099868],[19.996686,44.09987],[19.997008,44.099922],[19.997463,44.100112],[19.997623,44.100159],[19.997692,44.100179],[19.998245,44.100295],[19.99855,44.100287],[19.999119,44.100453],[20.000702,44.100665],[20.000746,44.100657],[20.001474,44.100526],[20.002,44.100503],[20.002279,44.100449],[20.003067,44.100168],[20.003845,44.099814],[20.00429,44.09971],[20.004886,44.09974],[20.005621,44.099648],[20.005638,44.099655],[20.005798,44.099729],[20.006028,44.099929],[20.006211,44.10026],[20.006624,44.100445],[20.00671,44.100557],[20.006887,44.100657],[20.007133,44.100738],[20.007375,44.100881],[20.007611,44.101093],[20.007863,44.101127],[20.007945,44.101154],[20.00834,44.101281],[20.009998,44.101139],[20.010529,44.101054],[20.011044,44.101034],[20.011013,44.101007],[20.011044,44.101034],[20.011198,44.101077],[20.011338,44.101116],[20.011451,44.101167],[20.011584,44.101226],[20.012229,44.101547],[20.012856,44.10196],[20.013179,44.102224],[20.01324,44.102273],[20.013327,44.102736],[20.013065,44.103324],[20.012896,44.103556],[20.012822,44.103599],[20.012772,44.103681],[20.012723,44.103805],[20.012578,44.103939],[20.012385,44.10407],[20.012155,44.104186],[20.011978,44.104336],[20.011961,44.10435],[20.011843,44.104452],[20.011715,44.10454],[20.011409,44.104771],[20.011173,44.104929],[20.010974,44.105122],[20.010932,44.105127],[20.010974,44.105122],[20.010851,44.105325],[20.010815,44.105601]]}}]},
				{
					useSimpleStyle: true
				})
			layer26.addTo(map)
			layers.addOverlay(layer26, 'segment 1')

			var layer27 = L.geoJSON(
				{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"stroke":"#0000FF"},"geometry":{"type":"LineString","coordinates":[[20.011126,44.107177],[20.011227,44.107361],[20.011197,44.107578],[20.011115,44.107633],[20.011197,44.107578],[20.011627,44.107289],[20.012081,44.107215],[20.012081,44.107215],[20.012469,44.10742],[20.01259,44.107509],[20.012784,44.107558],[20.013014,44.107619],[20.013593,44.108036],[20.013859,44.108185],[20.014154,44.108231],[20.014433,44.108191],[20.014594,44.108021],[20.015224,44.107486],[20.015275,44.107457],[20.015295,44.107443],[20.015465,44.107333],[20.01565,44.107158],[20.01617,44.106839],[20.01634,44.106686],[20.016621,44.106451],[20.016742,44.106243],[20.016726,44.105999],[20.016656,44.105783],[20.016627,44.105519],[20.016637,44.105386],[20.016699,44.105379],[20.016737,44.105376],[20.016824,44.105367],[20.017243,44.105405],[20.01779,44.105474],[20.018176,44.105571],[20.018471,44.105621],[20.018657,44.105561],[20.019405,44.105328],[20.019861,44.105166],[20.019865,44.10516],[20.019861,44.105166],[20.020011,44.105228],[20.020053,44.105323],[20.020187,44.10563]]}}]},
				{
					useSimpleStyle: true
				})
			layer27.addTo(map)
			layers.addOverlay(layer27, 'segment 2')

			var layer28 = L.geoJSON(
				{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"stroke":"#0000FF"},"geometry":{"type":"LineString","coordinates":[[20.023941,44.114749],[20.023874,44.115009],[20.023686,44.115255],[20.023586,44.1155],[20.023585,44.115506],[20.023584,44.115589],[20.023477,44.115772],[20.023343,44.115974],[20.023305,44.116166],[20.0234,44.116441],[20.023499,44.116614],[20.023552,44.116673],[20.023643,44.116699],[20.023663,44.116859],[20.023666,44.116884],[20.023251,44.11697],[20.022961,44.117023],[20.022698,44.117089],[20.022602,44.117189],[20.022419,44.117258],[20.021904,44.117397],[20.021631,44.117516],[20.021218,44.117817],[20.020858,44.117925],[20.020392,44.117971],[20.019984,44.11799],[20.019791,44.117848],[20.019541,44.117799],[20.019442,44.117815],[20.019343,44.117878],[20.019206,44.118013],[20.019187,44.118125],[20.019123,44.118206],[20.019018,44.118235],[20.018919,44.118304],[20.018777,44.118366],[20.018452,44.118393],[20.018265,44.1184],[20.018114,44.118375],[20.017978,44.118339],[20.017892,44.118381],[20.01772,44.118404],[20.017532,44.118414],[20.01735,44.118412],[20.017101,44.118391],[20.016953,44.118352],[20.01673,44.118329],[20.016567,44.118262],[20.016446,44.118146],[20.016199,44.118075],[20.015997,44.11798],[20.01568,44.117787],[20.015509,44.117716],[20.01539,44.117698],[20.01536,44.117694],[20.014952,44.117678],[20.014657,44.117689],[20.014217,44.117666],[20.013895,44.117659],[20.013681,44.117624],[20.013547,44.117516],[20.013354,44.117539],[20.013203,44.117601],[20.012962,44.117559],[20.012678,44.117578],[20.012377,44.117628],[20.012109,44.117655],[20.011889,44.117574],[20.011594,44.117555],[20.011369,44.117628],[20.011095,44.117624],[20.010838,44.117578],[20.010655,44.117478],[20.010446,44.117439],[20.010183,44.11752],[20.010006,44.117624],[20.009802,44.117674],[20.009609,44.117609],[20.009379,44.117478],[20.009191,44.11727],[20.008987,44.11702],[20.008826,44.116788],[20.008708,44.116634],[20.008582,44.11643],[20.00851,44.11634],[20.008306,44.116165],[20.008287,44.116177],[20.00797,44.116384],[20.007742,44.11655],[20.007681,44.116659],[20.007568,44.116894],[20.007533,44.117002],[20.00752,44.117102],[20.007527,44.117119],[20.007539,44.117147],[20.007662,44.117206],[20.00796,44.11736],[20.008121,44.117453],[20.00829,44.117532],[20.00844,44.117582],[20.008665,44.117624],[20.008729,44.117703],[20.00877,44.117794],[20.008785,44.117889],[20.008837,44.117966],[20.00886,44.118235],[20.008888,44.118376],[20.009084,44.118721],[20.009196,44.118992],[20.009224,44.11918],[20.009223,44.119356],[20.009168,44.119576],[20.009096,44.119749],[20.009078,44.119743],[20.008897,44.119688],[20.00882,44.119674],[20.008623,44.119654],[20.008375,44.119648],[20.006385,44.11973],[20.006361,44.119731],[20.006385,44.11973],[20.006375,44.119675],[20.005972,44.119597],[20.00579,44.119542],[20.005457,44.119504],[20.005167,44.119502],[20.004795,44.119475],[20.004715,44.119413],[20.004632,44.119399],[20.004529,44.119358],[20.004499,44.119346],[20.004366,44.119332],[20.004199,44.119296],[20.004043,44.11927],[20.003906,44.119193],[20.003813,44.119158],[20.003624,44.119138],[20.00351,44.119105],[20.003391,44.119057],[20.003244,44.118988],[20.003145,44.118964],[20.002964,44.119065],[20.002943,44.119078],[20.002538,44.11916],[20.002263,44.119187],[20.002003,44.119114],[20.001676,44.118922],[20.001495,44.118863],[20.001163,44.118814],[20.000873,44.118836],[20.000625,44.118922],[20.000478,44.119024],[20.000451,44.119042],[20.000346,44.119117],[20.000218,44.119352],[19.999916,44.119604],[19.999581,44.120018],[19.999309,44.120182],[19.998863,44.120347],[19.997983,44.120271],[19.997655,44.120187],[19.996869,44.119951],[19.996671,44.119885],[19.996522,44.1198],[19.995903,44.119702],[19.995605,44.119644],[19.995327,44.119609],[19.995196,44.119567],[19.995144,44.11955],[19.995366,44.119541],[19.995618,44.119514],[19.996058,44.119427],[19.996106,44.119392],[19.99609,44.11935],[19.995752,44.119053],[19.995661,44.118963],[19.995618,44.118828],[19.995634,44.118676],[19.995664,44.118518],[19.995682,44.118345],[19.995709,44.118191],[19.995806,44.118085],[19.995843,44.117985],[19.995747,44.117887],[19.995691,44.117751],[19.995761,44.117694],[19.995788,44.117674],[19.995938,44.117536],[19.996126,44.117285],[19.996156,44.117187],[19.996191,44.116906],[19.996173,44.116746],[19.996157,44.11661],[19.996116,44.116407],[19.996132,44.116357],[19.996167,44.116249],[19.99624,44.116134],[19.996269,44.115876],[19.996486,44.115527],[19.996503,44.115084],[19.996555,44.114884],[19.996652,44.114825],[19.99676,44.114752],[19.996973,44.114601],[19.997025,44.114518],[19.996993,44.114453],[19.997007,44.114237],[19.99704,44.11402],[19.997026,44.113821],[19.997031,44.113754],[19.99705,44.113653],[19.997107,44.11349],[19.997071,44.113466],[19.997107,44.11349],[19.997379,44.113692],[19.997643,44.113918],[19.997802,44.114072],[19.998194,44.114502],[19.998271,44.114458],[19.998401,44.114387],[19.998664,44.114287],[19.999061,44.114118],[19.999372,44.113952],[19.999549,44.113864],[19.999731,44.11376],[19.999726,44.11375],[19.999691,44.113679],[19.999294,44.113351],[19.999353,44.113247],[19.999299,44.113128],[19.998999,44.112901],[19.998892,44.11277],[19.998742,44.112639],[19.998597,44.112643],[19.998736,44.112523],[19.998751,44.112419],[19.998757,44.11238],[19.999049,44.112198],[19.999194,44.112009],[19.999176,44.111871],[19.999132,44.111535],[19.999366,44.111396],[19.999786,44.11124],[20.000192,44.111088],[20.000626,44.111061],[20.001068,44.111152],[20.001168,44.111173],[20.001329,44.111158],[20.001794,44.110993],[20.001933,44.110945],[20.001794,44.110993],[20.001871,44.110911],[20.001981,44.110817],[20.002024,44.110734],[20.002,44.110618],[20.001957,44.110513],[20.00193,44.110401],[20.001903,44.110191],[20.001855,44.110004],[20.001783,44.109867],[20.001788,44.109696],[20.001839,44.109584],[20.001851,44.109506],[20.001871,44.109384],[20.001759,44.109226],[20.001786,44.109137],[20.001823,44.109056],[20.001872,44.109011],[20.001879,44.108978],[20.001865,44.10895],[20.001871,44.108948]]}}]},
				{
					useSimpleStyle: true
				})
			layer28.addTo(map)
			layers.addOverlay(layer28, 'segment 3')
			if (window.location.hash) {
				var splits = window.location.hash.substring(5).split('/')
				map.setView([parseFloat(splits[1]), parseFloat(splits[2])], parseInt(splits[0]))
			} else {
				if (defaultBounds != null) { 
					map.fitBounds(defaultBounds, null)
				} else {
					map.setView([44.82763029742812, 20.50529479980469], 10)
				}
			}
			window.onhashchange = function() {
				var splits = window.location.hash.substring(5).split('/')
				map.setView([parseFloat(splits[1]), parseFloat(splits[2])], parseInt(splits[0]))
			}
			map.on(
				'moveend',
				function() {
					window.location.hash = '#map=' + map.getZoom() + '/' + map.getCenter().lat + '/' + map.getCenter().lng
				})

		</script>
	</body>
</html>
